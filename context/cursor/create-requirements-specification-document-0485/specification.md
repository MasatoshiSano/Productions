# マッチングサイトアプリ 要件定義書

## 📋 概要

ユーザー同士の出会いやマッチングを促進する完全無料のWebアプリケーションです。ユーザーがプロフィールを作成し、都道府県ベースでお互いの情報を閲覧し、興味のある相手とマッチングしてリアルタイムメッセージで交流できるプラットフォームを提供します。シンプルで使いやすい日本語インターフェースを採用し、100ユーザー規模での運用を想定しています。

## 🎯 要求

- ユーザー登録・認証機能（メール認証、自己申告による年齢認証）
- プロフィール作成・編集機能（写真最大6枚、20MB以下）
- ユーザー検索・閲覧機能（都道府県ベース、最大20件表示）
- マッチング機能（相互の「いいね」によるマッチング）
- メッセージ機能（マッチしたユーザー同士のリアルタイム通信）
- ユーザー設定・プライバシー管理
- 管理者機能（基本的な管理機能のみ）
- 通知機能（メール通知、即座送信）
- ブロック・報告機能（制裁機能なし）
- 完全無料サービス
- 日本語単一言語対応
- レスポンシブデザイン

## 📝 機能仕様

### 画面/コンポーネント構成

#### 1. 認証関連
- **ユーザー登録画面**
  - メールアドレス・パスワード入力
  - 基本情報入力（性別、年齢、居住地）
  - 利用規約同意チェックボックス
  - Instagram風のシンプルなデザイン

- **ログイン画面**
  - メールアドレス・パスワード入力
  - ログイン状態保持オプション
  - パスワード忘れリンク

- **パスワード関連画面**
  - パスワード忘れ（メール送信）
  - パスワード変更
  - メールアドレス確認

#### 2. プロフィール関連
- **プロフィール作成・編集画面**
  - 基本情報（名前、年齢、性別、居住地）
  - 自己紹介文（最大500文字）
  - 職業・学歴・趣味
  - 写真アップロード（最大6枚）
  - 身長・体重・血液型などの詳細情報
  - 希望条件設定（年齢範囲、居住地範囲等）

- **プロフィール表示画面**
  - 写真ギャラリー
  - 基本情報表示
  - 自己紹介文表示
  - 「いいね」「パス」ボタン

#### 3. マッチング関連
- **ユーザー発見画面**
  - カード形式でのユーザー表示
  - スワイプ機能（右：いいね、左：パス）
  - 詳細プロフィール表示リンク
  - 検索フィルター機能

- **マッチング通知画面**
  - マッチング成立時の通知表示
  - 「メッセージを送る」ボタン

- **マッチング一覧画面**
  - マッチしたユーザー一覧
  - 最新メッセージプレビュー
  - 未読メッセージ表示

#### 4. メッセージ関連
- **メッセージ一覧画面**
  - チャット形式の会話履歴
  - 未読メッセージ表示
  - 相手のオンライン状態表示

- **メッセージ詳細画面**
  - リアルタイムチャット
  - 写真送信機能
  - 相手のプロフィール表示リンク

#### 5. 設定関連
- **設定画面**
  - プライバシー設定
  - 通知設定
  - ブロックリスト管理
  - アカウント削除

- **検索設定画面**
  - 年齢範囲設定
  - 距離範囲設定
  - その他の希望条件設定

#### 6. 管理者機能
- **管理者ダッシュボード**
  - ユーザー管理
  - 報告内容管理
  - 利用統計表示

### 振る舞い

#### ユーザー登録・認証
- 新規ユーザー登録時にメール認証を実施
- パスワードは8文字以上、英数字混合を必須とする
- 18歳未満の利用を禁止（年齢認証実施）

#### プロフィール管理
- 初回ログイン時にプロフィール作成を必須とする
- 写真は最低1枚の登録を必須とする（最大6枚）
- 写真は最大20MB、JPEG/PNG/GIF/WebP形式対応
- アップロード時に自動リサイズ・圧縮機能
- 写真は自動公開（管理者承認不要）

#### マッチング機能
- 相互に「いいね」した場合のみマッチング成立
- 一度「パス」したユーザーは24時間再表示されない
- 都道府県レベルでの地理的範囲を考慮した表示
- 検索結果は最大20件表示

#### メッセージ機能
- マッチしたユーザー同士のみメッセージ交換可能
- メッセージ送信頻度の制限なし
- WebSocketを使用したリアルタイム通信
- メッセージは永続保存

#### 通知機能
- 新しいマッチング時にメール通知
- 新しいメッセージ受信時にメール通知
- プロフィール閲覧時にメール通知
- 「いいね」受信時にメール通知
- 設定でオン/オフ切り替え可能
- 通知は即座に送信

#### ブロック・報告機能
- 任意のユーザーのブロック機能
- 不適切なユーザーの報告機能
- 報告内容の管理者による確認（制裁機能は実装しない）

### 制約条件

#### 技術的制約
- Django + Bootstrap 5での開発
- SQLiteデータベース使用
- 外部APIの使用禁止
- CDN使用禁止（ローカルアセットのみ）
- Reactなどのフロントエンドフレームワーク使用禁止

#### ビジネス的制約
- 18歳未満の利用禁止（自己申告による年齢認証）
- 1人1アカウントの原則（メールアドレス重複チェック）
- 完全無料サービス
- 個人情報保護法準拠

#### セキュリティ制約
- CSRF対策必須
- XSS対策必須
- SQLインジェクション対策必須
- 画像アップロード時のセキュリティチェック

## 📊 データ要件

### ユーザー関連データ
```python
# User (Django標準)
- username: 一意のユーザー名
- email: メールアドレス
- password: ハッシュ化パスワード
- first_name: 名前
- last_name: 姓
- date_joined: 登録日時
- is_active: アクティブ状態

# Profile (拡張プロフィール)
- user: Userとの1対1関係
- age: 年齢
- gender: 性別
- prefecture: 都道府県
- bio: 自己紹介文（最大500文字）
- occupation: 職業
- education: 学歴
- interests: 趣味
- height: 身長
- weight: 体重
- blood_type: 血液型
- photos: 写真（最大6枚、20MB以下、JPEG/PNG/GIF/WebP対応）
- created_at: 作成日時
- updated_at: 更新日時
```

### マッチング関連データ
```python
# Like (いいね)
- user: いいねしたユーザー
- target_user: いいねされたユーザー
- created_at: いいね日時

# Match (マッチング)
- user1: ユーザー1
- user2: ユーザー2
- created_at: マッチング成立日時
- is_active: アクティブ状態

# Block (ブロック)
- user: ブロックしたユーザー
- blocked_user: ブロックされたユーザー
- created_at: ブロック日時
```

### メッセージ関連データ
```python
# Message (メッセージ)
- sender: 送信者
- recipient: 受信者
- content: メッセージ内容
- is_read: 既読状態
- created_at: 送信日時
- message_type: メッセージタイプ（テキスト/画像）
```

### 設定関連データ
```python
# UserSettings (ユーザー設定)
- user: ユーザー
- age_min: 希望年齢下限
- age_max: 希望年齢上限
- preferred_prefectures: 希望都道府県（複数選択可）
- show_me: 表示対象性別
- notifications_enabled: 通知設定
- sort_preference: 表示順序設定（登録日順、最終ログイン順、年齢順等）
- created_at: 作成日時
- updated_at: 更新日時
```

## 🔄 インタラクション

### 外部システム連携
- メール送信機能（パスワードリセット、通知）
- ファイルアップロード機能（プロフィール写真）

### 内部システム連携
- Django認証システム
- Django Allauth（ユーザー認証）
- WebSocket（リアルタイムメッセージング）
- Django管理画面（管理者機能）

### APIエンドポイント
```
# 認証関連
POST /accounts/signup/ - ユーザー登録
POST /accounts/login/ - ログイン
POST /accounts/logout/ - ログアウト
POST /accounts/password/reset/ - パスワードリセット

# プロフィール関連
GET /profile/ - プロフィール表示
POST /profile/ - プロフィール更新
POST /profile/photos/ - 写真アップロード

# マッチング関連
GET /discover/ - ユーザー発見
POST /like/ - いいね
POST /pass/ - パス
GET /matches/ - マッチング一覧

# メッセージ関連
GET /messages/ - メッセージ一覧
POST /messages/ - メッセージ送信
WebSocket /ws/chat/ - リアルタイムチャット

# 設定関連
GET /settings/ - 設定表示
POST /settings/ - 設定更新
POST /block/ - ユーザーブロック
POST /report/ - ユーザー報告
```

## ✅ 確定仕様

### 1. **マッチング範囲**
- **地理的範囲の計算方法**：都道府県レベルでの範囲設定
- **位置情報の精度**：都道府県レベルの大まかな地域情報
- **デフォルトの距離範囲**：同一都道府県内

### 2. **写真管理**
- **写真のサイズ制限**：1枚あたり最大20MB
- **画像形式の制限**：JPEG、PNG、GIF、WebP形式対応
- **画像の自動処理**：アップロード時に自動リサイズ・圧縮機能を実装
- **写真の審査**：自動公開（管理者による事前承認不要）

### 3. **通知機能**
- **メール通知の頻度**：各アクション発生時に即座に送信
- **通知の種類**：いいね、マッチング、メッセージ、プロフィール閲覧のすべて
- **プッシュ通知**：ブラウザ通知機能は実装しない

### 4. **セキュリティ**
- **本人確認方法**：身分証明書のアップロード機能は実装しない
- **年齢認証方法**：自己申告のみ（登録時の年齢入力）
- **不正アカウント対策**：メールアドレス重複チェック、IP制限等の基本的な対策

### 5. **管理機能**
- **管理者権限のレベル**：単一の管理者ロール（スーパーアドミンのみ）
- **ユーザー制裁の種類**：実装しない
- **制裁の基準**：実装しない

### 6. **データ保持**
- **削除アカウントのデータ**：アカウント削除と同時に完全削除
- **メッセージ履歴の保持期間**：永続保存
- **ログの保持期間**：標準的な期間（30日間）

### 7. **パフォーマンス**
- **想定同時接続ユーザー数**：100ユーザー
- **メッセージ送信頻度制限**：制限なし
- **検索結果の表示件数**：1回の検索で最大20件表示

### 8. **多言語対応**
- **対応言語**：日本語・英語のみ
- **翻訳対象の範囲**：実装しない（日本語単一言語）
- **ユーザー生成コンテンツ**：翻訳機能は実装しない

### 9. **検索機能**
- **検索結果の表示順序**：ユーザーが選択可能（登録日順、最終ログイン順、年齢順等）
- **詳細検索の項目**：プロフィールの全項目で絞り込み可能
- **検索の保存機能**：実装しない

### 10. **料金体系**
- **無料版と有料版の機能差**：すべて無料（制限なし）
- **課金機能の実装**：実装しない
- **広告表示**：実装しない

## 🔧 追加仕様

### パフォーマンス要件
- **想定同時接続ユーザー数**：100ユーザー
- **データベース**：SQLite使用（小規模運用想定）
- **レスポンス時間**：一般的な操作で3秒以内

### 画面表示要件
- **検索結果表示件数**：1回の検索で最大20件
- **ページネーション**：必要に応じて実装
- **検索順序**：ユーザーが選択可能（登録日順、最終ログイン順、年齢順等）

### データ管理要件
- **アカウント削除**：完全削除（データ復旧不可）
- **メッセージ履歴**：永続保存
- **ログ保持**：30日間

### 機能制限
- **多言語対応**：日本語のみ（英語対応は実装しない）
- **ユーザー制裁機能**：実装しない
- **プッシュ通知**：実装しない
- **検索条件保存**：実装しない

## ⚠️ 追加検討が必要な要件

### 1. **オンライン状態・アクティビティ**
- **最終ログイン時間の表示**：ユーザーの最終ログイン時間を表示するか？
- **オンライン状態の表示**：現在オンライン中のユーザーを識別表示するか？
- **アクティビティフィード**：ユーザーの活動履歴（プロフィール更新、新規写真追加等）を表示するか？

### 2. **プライバシー・表示制御**
- **プロフィール閲覧履歴**：誰が自分のプロフィールを見たかの履歴機能は必要か？
- **プロフィール公開範囲**：全ユーザーに公開か、特定条件のユーザーのみか？
- **写真の部分隠し機能**：マッチ前は一部写真をぼかし表示等の機能は必要か？

### 3. **マッチング関連の詳細**
- **マッチング解除機能**：マッチ後に関係を解除する機能は必要か？
- **「いいね」の取り消し**：送信した「いいね」を取り消す機能は必要か？
- **相互「いいね」の通知タイミング**：マッチ成立の瞬間にリアルタイム通知するか？

### 4. **プロフィール詳細**
- **写真の順序変更**：プロフィール写真の表示順序を変更する機能は必要か？
- **写真の削除**：個別写真の削除機能は必要か？
- **プロフィール項目の公開/非公開設定**：年齢や職業等の個別項目の表示制御は必要か？

### 5. **検索・フィルタリング機能**
- **いいね済みユーザーの除外**：既に「いいね」したユーザーを検索結果から除外するか？
- **ブロック済みユーザーの除外**：ブロックしたユーザーを自動的に検索結果から除外するか？
- **年齢認証必須フィルター**：年齢認証済みユーザーのみを表示するフィルターは必要か？

### 6. **セキュリティ・安全性**
- **不適切な画像の検出**：AIによる不適切な画像の自動検出機能は必要か？
- **スパムメッセージ対策**：同じメッセージの連続送信防止機能は必要か？
- **偽アカウント対策**：メール認証以外の認証方法は必要か？

### 7. **ユーザビリティ**
- **チュートリアル機能**：初回ユーザー向けの使い方ガイドは必要か？
- **ヘルプ・FAQ**：よくある質問やヘルプページは必要か？
- **フィードバック機能**：ユーザーからの改善提案を受け付ける機能は必要か？

### 8. **データ管理・統計**
- **利用規約・プライバシーポリシー**：法的文書の表示ページは必要か？
- **ユーザー統計**：管理者が見るユーザー数や活動状況の統計は必要か？
- **データエクスポート**：ユーザーが自分のデータをダウンロードする機能は必要か？

### 9. **通知の詳細設定**
- **通知カテゴリ別ON/OFF**：いいね、メッセージ、マッチング等の通知を個別に設定できるか？
- **通知の頻度制限**：同じユーザーからの通知を一定時間制限する機能は必要か？

### 10. **モバイル対応**
- **PWA対応**：モバイルアプリのような操作感を提供するか？
- **画面サイズ別最適化**：スマートフォン、タブレット、PC での表示最適化レベルは？