# マッチングサイトアプリ 要件定義書

## 📋 概要

ユーザー同士の出会いやマッチングを促進するWebアプリケーションです。ユーザーがプロフィールを作成し、お互いの情報を閲覧し、興味のある相手とマッチングして交流できるプラットフォームを提供します。

## 🎯 要求

- ユーザー登録・認証機能
- プロフィール作成・編集機能
- ユーザー検索・閲覧機能
- マッチング機能（相互の「いいね」によるマッチング）
- メッセージ機能（マッチしたユーザー同士のコミュニケーション）
- ユーザー設定・プライバシー管理
- 管理者機能
- 通知機能
- ブロック・報告機能
- 年齢認証機能
- 多言語対応（日本語・英語）
- レスポンシブデザイン

## 📝 機能仕様

### 画面/コンポーネント構成

#### 1. 認証関連
- **ユーザー登録画面**
  - メールアドレス・パスワード入力
  - 基本情報入力（性別、年齢、居住地）
  - 利用規約同意チェックボックス
  - Instagram風のシンプルなデザイン

- **ログイン画面**
  - メールアドレス・パスワード入力
  - ログイン状態保持オプション
  - パスワード忘れリンク

- **パスワード関連画面**
  - パスワード忘れ（メール送信）
  - パスワード変更
  - メールアドレス確認

#### 2. プロフィール関連
- **プロフィール作成・編集画面**
  - 基本情報（名前、年齢、性別、居住地）
  - 自己紹介文（最大500文字）
  - 職業・学歴・趣味
  - 写真アップロード（最大6枚）
  - 身長・体重・血液型などの詳細情報
  - 希望条件設定（年齢範囲、居住地範囲等）

- **プロフィール表示画面**
  - 写真ギャラリー
  - 基本情報表示
  - 自己紹介文表示
  - 「いいね」「パス」ボタン

#### 3. マッチング関連
- **ユーザー発見画面**
  - カード形式でのユーザー表示
  - スワイプ機能（右：いいね、左：パス）
  - 詳細プロフィール表示リンク
  - 検索フィルター機能

- **マッチング通知画面**
  - マッチング成立時の通知表示
  - 「メッセージを送る」ボタン

- **マッチング一覧画面**
  - マッチしたユーザー一覧
  - 最新メッセージプレビュー
  - 未読メッセージ表示

#### 4. メッセージ関連
- **メッセージ一覧画面**
  - チャット形式の会話履歴
  - 未読メッセージ表示
  - 相手のオンライン状態表示

- **メッセージ詳細画面**
  - リアルタイムチャット
  - 写真送信機能
  - 相手のプロフィール表示リンク

#### 5. 設定関連
- **設定画面**
  - プライバシー設定
  - 通知設定
  - ブロックリスト管理
  - アカウント削除

- **検索設定画面**
  - 年齢範囲設定
  - 距離範囲設定
  - その他の希望条件設定

#### 6. 管理者機能
- **管理者ダッシュボード**
  - ユーザー管理
  - 報告内容管理
  - 利用統計表示

### 振る舞い

#### ユーザー登録・認証
- 新規ユーザー登録時にメール認証を実施
- パスワードは8文字以上、英数字混合を必須とする
- 18歳未満の利用を禁止（年齢認証実施）

#### プロフィール管理
- 初回ログイン時にプロフィール作成を必須とする
- 写真は最低1枚の登録を必須とする
- 不適切な写真や内容の自動検出・警告機能

#### マッチング機能
- 相互に「いいね」した場合のみマッチング成立
- 一度「パス」したユーザーは24時間再表示されない
- 地理的距離を考慮した表示順序

#### メッセージ機能
- マッチしたユーザー同士のみメッセージ交換可能
- 不適切なメッセージの自動検出・警告
- WebSocketを使用したリアルタイム通信

#### 通知機能
- 新しいマッチング時
- 新しいメッセージ受信時
- プロフィール閲覧時
- 設定でオン/オフ切り替え可能

#### ブロック・報告機能
- 任意のユーザーのブロック機能
- 不適切なユーザーの報告機能
- 報告内容の管理者による審査

### 制約条件

#### 技術的制約
- Django + Bootstrap 5での開発
- SQLiteデータベース使用
- 外部APIの使用禁止
- CDN使用禁止（ローカルアセットのみ）
- Reactなどのフロントエンドフレームワーク使用禁止

#### ビジネス的制約
- 18歳未満の利用禁止
- 1人1アカウントの原則
- 商用利用禁止
- 個人情報保護法準拠

#### セキュリティ制約
- CSRF対策必須
- XSS対策必須
- SQLインジェクション対策必須
- 画像アップロード時のセキュリティチェック

## 📊 データ要件

### ユーザー関連データ
```python
# User (Django標準)
- username: 一意のユーザー名
- email: メールアドレス
- password: ハッシュ化パスワード
- first_name: 名前
- last_name: 姓
- date_joined: 登録日時
- is_active: アクティブ状態

# Profile (拡張プロフィール)
- user: Userとの1対1関係
- age: 年齢
- gender: 性別
- location: 居住地
- bio: 自己紹介文
- occupation: 職業
- education: 学歴
- interests: 趣味
- height: 身長
- photos: 写真（最大6枚）
- is_verified: 認証状態
- created_at: 作成日時
- updated_at: 更新日時
```

### マッチング関連データ
```python
# Like (いいね)
- user: いいねしたユーザー
- target_user: いいねされたユーザー
- created_at: いいね日時

# Match (マッチング)
- user1: ユーザー1
- user2: ユーザー2
- created_at: マッチング成立日時
- is_active: アクティブ状態

# Block (ブロック)
- user: ブロックしたユーザー
- blocked_user: ブロックされたユーザー
- created_at: ブロック日時
```

### メッセージ関連データ
```python
# Message (メッセージ)
- sender: 送信者
- recipient: 受信者
- content: メッセージ内容
- is_read: 既読状態
- created_at: 送信日時
- message_type: メッセージタイプ（テキスト/画像）
```

### 設定関連データ
```python
# UserSettings (ユーザー設定)
- user: ユーザー
- age_min: 希望年齢下限
- age_max: 希望年齢上限
- distance_km: 希望距離範囲
- show_me: 表示対象性別
- notifications_enabled: 通知設定
- created_at: 作成日時
- updated_at: 更新日時
```

## 🔄 インタラクション

### 外部システム連携
- メール送信機能（パスワードリセット、通知）
- ファイルアップロード機能（プロフィール写真）

### 内部システム連携
- Django認証システム
- Django Allauth（ユーザー認証）
- WebSocket（リアルタイムメッセージング）
- Django管理画面（管理者機能）

### APIエンドポイント
```
# 認証関連
POST /accounts/signup/ - ユーザー登録
POST /accounts/login/ - ログイン
POST /accounts/logout/ - ログアウト
POST /accounts/password/reset/ - パスワードリセット

# プロフィール関連
GET /profile/ - プロフィール表示
POST /profile/ - プロフィール更新
POST /profile/photos/ - 写真アップロード

# マッチング関連
GET /discover/ - ユーザー発見
POST /like/ - いいね
POST /pass/ - パス
GET /matches/ - マッチング一覧

# メッセージ関連
GET /messages/ - メッセージ一覧
POST /messages/ - メッセージ送信
WebSocket /ws/chat/ - リアルタイムチャット

# 設定関連
GET /settings/ - 設定表示
POST /settings/ - 設定更新
POST /block/ - ユーザーブロック
POST /report/ - ユーザー報告
```

## ❓ 未解決の質問

1. **マッチング範囲の詳細**
   - 地理的範囲の計算方法は？（GPS座標 vs 都道府県）
   - 位置情報の精度レベルは？

2. **写真管理**
   - 写真のサイズ制限は？
   - 画像形式の制限は？（JPEG/PNG/GIF）
   - 画像の自動リサイズ機能は必要？

3. **通知機能**
   - メール通知の頻度制限は？
   - プッシュ通知は必要？

4. **セキュリティ**
   - 本人確認の方法は？
   - 年齢認証の具体的な方法は？

5. **管理機能**
   - 管理者権限の詳細は？
   - ユーザー制裁の種類と基準は？

6. **データ保持**
   - 削除されたアカウントのデータ保持期間は？
   - メッセージ履歴の保持期間は？

7. **パフォーマンス**
   - 同時接続ユーザー数の想定は？
   - メッセージ送信頻度の制限は？

8. **多言語対応**
   - 対応言語は日本語・英語のみ？
   - 翻訳対象の範囲は？

9. **検索機能**
   - 検索結果の表示順序のアルゴリズムは？
   - 詳細検索の項目は？

10. **料金体系**
    - 無料版と有料版の機能差は？
    - 課金機能は必要？