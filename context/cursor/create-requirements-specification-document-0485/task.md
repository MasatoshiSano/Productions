# マッチングサイトアプリ タスク一覧

## 📋 概要

Django + Bootstrap 5を使用したマッチングサイトアプリケーションを実装する。
ユーザー認証、プロフィール管理、マッチング機能、リアルタイムメッセージング、管理機能を含む。

## ✅ タスクリスト

### フェーズ1: プロジェクトセットアップとユーザー認証

#### 1. **Djangoプロジェクト初期セットアップ**
- 概要: Django プロジェクトの基本構成とアプリケーション構造を作成
- 完了条件:
  - [ ] Django プロジェクト作成 (`matching_site`)
  - [ ] アプリケーション作成 (`accounts`, `matching`, `messaging`, `core`)
  - [ ] `settings.py` 設定完了（Bootstrap 5, 静的ファイル設定）
  - [ ] `requirements.txt` 作成完了
- 動作確認:
  - [ ] `python manage.py runserver` で起動確認
  - [ ] Bootstrap 5 の読み込み確認
- メモ: Django Channels, Pillowなどの依存関係も含める

#### 2. **カスタムUserモデルの作成**
- 概要: AbstractUserを継承したカスタムUserモデルを作成
- 完了条件:
  - [ ] `accounts/models.py` にCustomUserモデル作成
  - [ ] `AUTH_USER_MODEL` 設定完了
  - [ ] 初期マイグレーション実行完了
- 動作確認:
  - [ ] `python manage.py test accounts` で通過
  - [ ] 管理画面でユーザー作成・編集確認
- メモ: 後でProfileモデルと1対1関係を作るため、拡張可能な設計にする

#### 3. **ユーザー登録機能の実装**
- 概要: ユーザー登録フォームとビューを作成
- 完了条件:
  - [ ] `accounts/forms.py` に登録フォーム作成
  - [ ] `accounts/views.py` に登録ビュー作成
  - [ ] 年齢認証（18歳以上）バリデーション実装
  - [ ] メール認証機能実装
- 動作確認:
  - [ ] `/accounts/signup/` で登録フォーム表示
  - [ ] 登録後にメール認証メール送信確認
  - [ ] 18歳未満の登録拒否確認
- メモ: Django-allauthを使用してメール認証を実装

#### 4. **ログイン・ログアウト機能の実装**
- 概要: Django標準認証を使用したログイン・ログアウト機能
- 完了条件:
  - [ ] `accounts/views.py` にログイン・ログアウトビュー作成
  - [ ] ログイン状態保持機能実装
  - [ ] パスワード忘れ機能実装
- 動作確認:
  - [ ] `/accounts/login/` でログイン確認
  - [ ] `/accounts/logout/` でログアウト確認
  - [ ] パスワードリセット機能確認
- メモ: CSRFトークンの適切な設定を確認

#### 5. **認証機能のテスト作成**
- 概要: 認証機能に対する単体テストを作成
- 完了条件:
  - [ ] `accounts/tests/test_models.py` 作成
  - [ ] `accounts/tests/test_views.py` 作成
  - [ ] `accounts/tests/test_forms.py` 作成
- 動作確認:
  - [ ] `python manage.py test accounts` で全テストパス
  - [ ] カバレッジ80%以上確認
- メモ: TestCaseとClientを使用したセッションテスト実装

### フェーズ2: プロフィール管理機能

#### 6. **Profileモデルの作成**
- 概要: ユーザープロフィール情報を管理するモデル作成
- 完了条件:
  - [ ] `accounts/models.py` にProfileモデル作成
  - [ ] Userとの1対1関係設定
  - [ ] 写真アップロード機能実装（最大6枚）
  - [ ] プロフィール項目バリデーション実装
- 動作確認:
  - [ ] `python manage.py test accounts` で通過
  - [ ] 管理画面でプロフィール作成・編集確認
- メモ: Pillowを使用した画像処理・リサイズ機能を含める

#### 7. **プロフィール作成・編集フォームの実装**
- 概要: プロフィール作成・編集用のフォームクラス作成
- 完了条件:
  - [ ] `accounts/forms.py` にProfileFormクラス作成
  - [ ] 写真アップロード機能実装
  - [ ] フォームバリデーション実装
  - [ ] 自己紹介文の文字数制限（500文字）
- 動作確認:
  - [ ] プロフィール作成フォーム表示確認
  - [ ] 画像アップロード動作確認
  - [ ] バリデーションエラー表示確認
- メモ: ModelFormを使用し、Bootstrap 5でスタイリング

#### 8. **プロフィール表示・編集ビューの実装**
- 概要: プロフィール表示・編集用のビュークラス作成
- 完了条件:
  - [ ] `accounts/views.py` にProfileViewクラス作成
  - [ ] 認証必須デコレータ適用
  - [ ] 初回ログイン時のプロフィール作成強制
  - [ ] 他ユーザーのプロフィール閲覧機能
- 動作確認:
  - [ ] `/profile/` でプロフィール表示確認
  - [ ] プロフィール編集機能確認
  - [ ] 未作成時のリダイレクト確認
- メモ: LoginRequiredMixinを使用

#### 9. **プロフィール管理のテスト作成**
- 概要: プロフィール機能に対する単体テストを作成
- 完了条件:
  - [ ] Profileモデルのテスト作成
  - [ ] ProfileFormのテスト作成
  - [ ] プロフィールビューのテスト作成
- 動作確認:
  - [ ] `python manage.py test accounts` で全テストパス
  - [ ] 画像アップロードテスト確認
- メモ: TemporaryFileを使用した画像アップロードテスト

### フェーズ3: マッチング機能

#### 10. **マッチング関連モデルの作成**
- 概要: Like, Match, Blockモデルを作成
- 完了条件:
  - [ ] `matching/models.py` にLike, Match, Blockモデル作成
  - [ ] 適切なリレーション設定
  - [ ] 重複防止制約設定
  - [ ] インデックス設定
- 動作確認:
  - [ ] `python manage.py test matching` で通過
  - [ ] 管理画面でモデル確認
- メモ: unique_togetherを使用して重複防止

#### 11. **ユーザー発見機能の実装**
- 概要: マッチング候補ユーザーを表示する機能
- 完了条件:
  - [ ] `matching/views.py` にDiscoveryViewクラス作成
  - [ ] 地理的距離フィルタリング実装
  - [ ] 年齢・性別フィルタリング実装
  - [ ] 既にいいね/パスしたユーザーの除外
- 動作確認:
  - [ ] `/discover/` でユーザー候補表示確認
  - [ ] フィルタリング機能確認
  - [ ] カード形式UI確認
- メモ: Bootstrap 5カードコンポーネントを使用

#### 12. **いいね・パス機能の実装**
- 概要: ユーザーへのいいね・パス機能とマッチング判定
- 完了条件:
  - [ ] `matching/views.py` にLikeView, PassView作成
  - [ ] Ajax対応（ページリロードなし）
  - [ ] マッチング成立判定ロジック実装
  - [ ] マッチング成立時の通知機能
- 動作確認:
  - [ ] いいね・パスボタン動作確認
  - [ ] マッチング成立通知確認
  - [ ] Ajax通信確認
- メモ: vanilla JavaScriptを使用（jQueryは最小限）

#### 13. **マッチング一覧機能の実装**
- 概要: マッチしたユーザーの一覧表示機能
- 完了条件:
  - [ ] `matching/views.py` にMatchListViewクラス作成
  - [ ] 最新メッセージプレビュー表示
  - [ ] 未読メッセージ表示
  - [ ] メッセージ画面へのリンク
- 動作確認:
  - [ ] `/matches/` でマッチング一覧表示確認
  - [ ] メッセージプレビュー確認
- メモ: select_related, prefetch_relatedでクエリ最適化

#### 14. **マッチング機能のテスト作成**
- 概要: マッチング機能に対する単体テストを作成
- 完了条件:
  - [ ] マッチングモデルのテスト作成
  - [ ] マッチングビューのテスト作成
  - [ ] Ajax機能のテスト作成
- 動作確認:
  - [ ] `python manage.py test matching` で全テストパス
  - [ ] マッチング判定ロジックテスト確認
- メモ: JSONレスポンスのテストを含める

### フェーズ4: メッセージング機能

#### 15. **メッセージモデルの作成**
- 概要: メッセージデータを管理するモデル作成
- 完了条件:
  - [ ] `messaging/models.py` にMessageモデル作成
  - [ ] 送信者・受信者のリレーション設定
  - [ ] 既読・未読状態管理
  - [ ] メッセージタイプ（テキスト/画像）対応
- 動作確認:
  - [ ] `python manage.py test messaging` で通過
  - [ ] 管理画面でメッセージ確認
- メモ: created_atにインデックス設定

#### 16. **メッセージ一覧・詳細ビューの実装**
- 概要: メッセージ一覧・詳細表示機能
- 完了条件:
  - [ ] `messaging/views.py` にMessageListView作成
  - [ ] チャット形式の詳細表示ビュー作成
  - [ ] 未読メッセージの既読化機能
  - [ ] マッチしたユーザー間のみ表示制限
- 動作確認:
  - [ ] `/messages/` でメッセージ一覧確認
  - [ ] チャット画面表示確認
  - [ ] 既読機能確認
- メモ: ページネーション実装を検討

#### 17. **WebSocketによるリアルタイム通信実装**
- 概要: Django Channelsを使用したリアルタイムメッセージング
- 完了条件:
  - [ ] `messaging/consumers.py` にWebSocketConsumer作成
  - [ ] `messaging/routing.py` にWebSocketルーティング設定
  - [ ] フロントエンドのWebSocket接続実装
  - [ ] メッセージの即座な表示機能
- 動作確認:
  - [ ] WebSocket接続確認
  - [ ] リアルタイムメッセージ送受信確認
  - [ ] 複数ユーザーでの同時接続確認
- メモ: Redisを使用した場合の設定も考慮

#### 18. **メッセージ送信機能の実装**
- 概要: メッセージ送信フォームとAjax処理
- 完了条件:
  - [ ] `messaging/forms.py` にMessageFormクラス作成
  - [ ] Ajax対応のメッセージ送信処理
  - [ ] 画像メッセージ対応
  - [ ] スパム防止機能
- 動作確認:
  - [ ] メッセージ送信フォーム確認
  - [ ] Ajax送信確認
  - [ ] 画像送信確認
- メモ: CSRF対策を忘れずに

#### 19. **メッセージ機能のテスト作成**
- 概要: メッセージ機能に対する単体テストを作成
- 完了条件:
  - [ ] Messageモデルのテスト作成
  - [ ] メッセージビューのテスト作成
  - [ ] WebSocketコンシューマーのテスト作成
- 動作確認:
  - [ ] `python manage.py test messaging` で全テストパス
  - [ ] WebSocket通信テスト確認
- メモ: ChannelsのTestingツールを使用

### フェーズ5: 管理・セキュリティ機能

#### 20. **ユーザー設定機能の実装**
- 概要: ユーザー設定（プライバシー、通知等）管理
- 完了条件:
  - [ ] `accounts/models.py` にUserSettingsモデル作成
  - [ ] 設定フォーム・ビュー作成
  - [ ] 検索範囲設定機能
  - [ ] 通知設定機能
- 動作確認:
  - [ ] `/settings/` で設定画面表示確認
  - [ ] 設定変更反映確認
- メモ: デフォルト値の設定を適切に行う

#### 21. **ブロック・報告機能の実装**
- 概要: ユーザーブロック・不適切ユーザー報告機能
- 完了条件:
  - [ ] `matching/models.py` にReportモデル作成
  - [ ] ブロック・報告フォーム作成
  - [ ] ブロックユーザーの表示除外機能
  - [ ] 管理者への報告通知機能
- 動作確認:
  - [ ] ブロック機能確認
  - [ ] 報告機能確認
  - [ ] ブロックユーザー除外確認
- メモ: 報告理由の分類機能を含める

#### 22. **管理者機能の実装**
- 概要: Django admin拡張とカスタム管理機能
- 完了条件:
  - [ ] `admin.py` カスタマイズ
  - [ ] 管理者ダッシュボード作成
  - [ ] ユーザー管理機能
  - [ ] 報告内容審査機能
- 動作確認:
  - [ ] 管理画面アクセス確認
  - [ ] ユーザー管理機能確認
  - [ ] 報告審査機能確認
- メモ: 管理者権限の適切な設定を行う

#### 23. **セキュリティ対策の実装**
- 概要: XSS、CSRF、SQLインジェクション対策
- 完了条件:
  - [ ] CSP（Content Security Policy）設定
  - [ ] ファイルアップロードセキュリティ強化
  - [ ] レート制限実装
  - [ ] 入力値検証強化
- 動作確認:
  - [ ] セキュリティテスト実施
  - [ ] ファイルアップロード制限確認
  - [ ] レート制限確認
- メモ: django-ratelimitを使用検討

#### 24. **管理・セキュリティ機能のテスト作成**
- 概要: 管理・セキュリティ機能に対する単体テストを作成
- 完了条件:
  - [ ] セキュリティ機能のテスト作成
  - [ ] 管理機能のテスト作成
  - [ ] 権限テスト作成
- 動作確認:
  - [ ] 全テストパス確認
  - [ ] セキュリティテスト確認
- メモ: セキュリティテストは特に重要

### フェーズ6: UI/UX仕上げと最適化

#### 25. **Bootstrap 5による UI実装**
- 概要: レスポンシブデザインとUI/UX改善
- 完了条件:
  - [ ] 全画面のBootstrap 5対応
  - [ ] レスポンシブデザイン実装
  - [ ] カスタムCSS作成
  - [ ] アイコン・画像素材追加
- 動作確認:
  - [ ] モバイル表示確認
  - [ ] タブレット表示確認
  - [ ] デスクトップ表示確認
- メモ: Bootstrap Iconsを使用

#### 26. **通知機能の実装**
- 概要: ブラウザ通知・メール通知機能
- 完了条件:
  - [ ] ブラウザ通知API実装
  - [ ] メール通知機能実装
  - [ ] 通知設定機能実装
  - [ ] 通知タイミング制御
- 動作確認:
  - [ ] 各種通知機能確認
  - [ ] 通知設定確認
- メモ: 通知の頻度制限を設ける

#### 27. **パフォーマンス最適化**
- 概要: データベースクエリ最適化と画像最適化
- 完了条件:
  - [ ] データベースクエリ最適化
  - [ ] 画像サイズ最適化
  - [ ] 静的ファイル圧縮
  - [ ] キャッシュ戦略実装
- 動作確認:
  - [ ] ページ読み込み速度確認
  - [ ] データベースクエリ数確認
- メモ: Django Debug Toolbarで確認

#### 28. **統合テスト・E2Eテスト**
- 概要: 全機能の統合テストとエンドツーエンドテスト
- 完了条件:
  - [ ] 全機能統合テスト作成
  - [ ] Seleniumによる自動化テスト
  - [ ] パフォーマンステスト
  - [ ] セキュリティテスト
- 動作確認:
  - [ ] 全テストパス確認
  - [ ] 実際のユーザーシナリオテスト
- メモ: テストデータの作成も含める

---

## ❓ 未解決の課題・確認事項

### 技術的課題
- **地理的距離計算**: GPS座標 vs 都道府県レベル、どちらで実装するか？
- **画像処理**: 自動リサイズのサイズ規格と品質設定
- **リアルタイム通信**: 同時接続数の上限とスケーリング方法
- **検索アルゴリズム**: ユーザー表示順序の詳細な仕様

### セキュリティ関連
- **年齢認証**: 具体的な認証方法（身分証明書アップロード等）
- **本人確認**: 写真と本人の一致確認方法
- **スパム対策**: メッセージ送信頻度制限の詳細

### UX関連
- **マッチング後の導線**: 初回メッセージの推奨文面やテンプレート
- **プロフィール項目**: 必須項目と任意項目の詳細分類
- **写真審査**: 不適切な写真の自動検出 vs 手動審査

### 運用関連
- **管理者権限**: 管理者アカウントの作成方法と権限範囲
- **データ保持**: 退会ユーザーのデータ削除タイミング
- **バックアップ**: データベースバックアップの頻度と方法

---

## 🔗 関連ドキュメント

- 実装要件: [specification.md](./specification.md)
- 設計方針: [design-doc.md](../../../design-doc.md)
- タスク分割指針: [make-task.md](../../../plan/make-task.md)

---

## 📊 進捗管理

### 現在の状況
- [ ] フェーズ1: プロジェクトセットアップとユーザー認証 (0/5)
- [ ] フェーズ2: プロフィール管理機能 (0/4)
- [ ] フェーズ3: マッチング機能 (0/5)
- [ ] フェーズ4: メッセージング機能 (0/5)
- [ ] フェーズ5: 管理・セキュリティ機能 (0/5)
- [ ] フェーズ6: UI/UX仕上げと最適化 (0/4)

### 全体進捗: 0/28 タスク完了

**注意**: 各フェーズの完了後、必ず `python manage.py test` と `flake8` でのコード品質チェックを実行してください。